#REST Client variables -------------------

#From the sm_url, last field in the service binding
@uri = https://service-manager.cfapps.us10.hana.ondemand.com

@oauth = oauth/token?grant_type=client_credentials

#From the url field in the service binding.
@uaa_url = https://f4195a6dtrial.authentication.us10.hana.ondemand.com

#From the clientid field in the service binding.  
@clientid = sb-53dd8c04-4264-4028-bca9-e22e03c9aa04!b388510|service-manager!b1476

#From the clientsecret field in the service binding.  
@clientsecret = a9e4bd2e-8e10-4c18-b580-b9d8c5e9a2ec$pB4jwWjDWv2HkGTypJDi7xf7Cev_s0QHFtf9Q_0evDU=

#Generated by the request bearer token call.  Copy the access_token value from the result without the quotes
@bearer = eyJhbGciOiJSUzI1NiIsImprdSI6Imh0dHBzOi8vZjQxOTVhNmR0cmlhbC5hdXRoZW50aWNhdGlvbi51czEwLmhhbmEub25kZW1hbmQuY29tL3Rva2VuX2tleXMiLCJraWQiOiJkZWZhdWx0LWp3dC1rZXktYWYzZDI0YWQxZiIsInR5cCI6IkpXVCIsImppZCI6ICJENW80aHovWUdqNm9odEI1c3Z3TVc2WHZaV0UxclJHL2dhMExHbGJOcVRVPSJ9.eyJqdGkiOiI1ODQxMTc1NzNhYmQ0ZDExODc3NjhjYWViMGNjNGE4OSIsImV4dF9hdHRyIjp7ImVuaGFuY2VyIjoiWFNVQUEiLCJzdWJhY2NvdW50aWQiOiIxY2QxYzFlNC1iNDg2LTQ4ZjQtYjQzNi0yMmY5ZjE2ODE3YjgiLCJ6ZG4iOiJmNDE5NWE2ZHRyaWFsIiwic2VydmljZWluc3RhbmNlaWQiOiI1M2RkOGMwNC00MjY0LTQwMjgtYmNhOS1lMjJlMDNjOWFhMDQifSwic3ViIjoic2ItNTNkZDhjMDQtNDI2NC00MDI4LWJjYTktZTIyZTAzYzlhYTA0IWIzODg1MTB8c2VydmljZS1tYW5hZ2VyIWIxNDc2IiwiYXV0aG9yaXRpZXMiOlsic2VydmljZS1tYW5hZ2VyIWIxNDc2LnN1YmFjY291bnQuc2VydmljZV9vZmZlcmluZy5yZWFkIiwic2VydmljZS1tYW5hZ2VyIWIxNDc2LnN1YmFjY291bnQuc2VydmljZV9pbnN0YW5jZS5yZWFkIiwic2VydmljZS1tYW5hZ2VyIWIxNDc2LnN1YmFjY291bnQuc2VydmljZV9wbGFuLnJlYWQiLCJ1YWEucmVzb3VyY2UiLCJzZXJ2aWNlLW1hbmFnZXIhYjE0NzYuc3ViYWNjb3VudC5icm9rZXIucmVhZCIsInNlcnZpY2UtbWFuYWdlciFiMTQ3Ni5zdWJhY2NvdW50LnBsYXRmb3JtLnJlYWQiLCJzZXJ2aWNlLW1hbmFnZXIhYjE0NzYuc3ViYWNjb3VudC5zZXJ2aWNlX2JpbmRpbmcucmVhZCIsInNlcnZpY2UtbWFuYWdlciFiMTQ3Ni5zdWJhY2NvdW50LnBsYXRmb3JtLm1hbmFnZSIsInNlcnZpY2UtbWFuYWdlciFiMTQ3Ni5zdWJhY2NvdW50LnNlcnZpY2VfYmluZGluZy5tYW5hZ2UiLCJzZXJ2aWNlLW1hbmFnZXIhYjE0NzYuc3ViYWNjb3VudC5zZXJ2aWNlX2luc3RhbmNlLm1hbmFnZSIsInNlcnZpY2UtbWFuYWdlciFiMTQ3Ni5zdWJhY2NvdW50LmJyb2tlci5tYW5hZ2UiXSwic2NvcGUiOlsic2VydmljZS1tYW5hZ2VyIWIxNDc2LnN1YmFjY291bnQuc2VydmljZV9vZmZlcmluZy5yZWFkIiwic2VydmljZS1tYW5hZ2VyIWIxNDc2LnN1YmFjY291bnQuc2VydmljZV9pbnN0YW5jZS5yZWFkIiwic2VydmljZS1tYW5hZ2VyIWIxNDc2LnN1YmFjY291bnQuc2VydmljZV9wbGFuLnJlYWQiLCJ1YWEucmVzb3VyY2UiLCJzZXJ2aWNlLW1hbmFnZXIhYjE0NzYuc3ViYWNjb3VudC5icm9rZXIucmVhZCIsInNlcnZpY2UtbWFuYWdlciFiMTQ3Ni5zdWJhY2NvdW50LnBsYXRmb3JtLnJlYWQiLCJzZXJ2aWNlLW1hbmFnZXIhYjE0NzYuc3ViYWNjb3VudC5zZXJ2aWNlX2JpbmRpbmcucmVhZCIsInNlcnZpY2UtbWFuYWdlciFiMTQ3Ni5zdWJhY2NvdW50LnBsYXRmb3JtLm1hbmFnZSIsInNlcnZpY2UtbWFuYWdlciFiMTQ3Ni5zdWJhY2NvdW50LnNlcnZpY2VfYmluZGluZy5tYW5hZ2UiLCJzZXJ2aWNlLW1hbmFnZXIhYjE0NzYuc3ViYWNjb3VudC5zZXJ2aWNlX2luc3RhbmNlLm1hbmFnZSIsInNlcnZpY2UtbWFuYWdlciFiMTQ3Ni5zdWJhY2NvdW50LmJyb2tlci5tYW5hZ2UiXSwiY2xpZW50X2lkIjoic2ItNTNkZDhjMDQtNDI2NC00MDI4LWJjYTktZTIyZTAzYzlhYTA0IWIzODg1MTB8c2VydmljZS1tYW5hZ2VyIWIxNDc2IiwiY2lkIjoic2ItNTNkZDhjMDQtNDI2NC00MDI4LWJjYTktZTIyZTAzYzlhYTA0IWIzODg1MTB8c2VydmljZS1tYW5hZ2VyIWIxNDc2IiwiYXpwIjoic2ItNTNkZDhjMDQtNDI2NC00MDI4LWJjYTktZTIyZTAzYzlhYTA0IWIzODg1MTB8c2VydmljZS1tYW5hZ2VyIWIxNDc2IiwiZ3JhbnRfdHlwZSI6ImNsaWVudF9jcmVkZW50aWFscyIsInJldl9zaWciOiI5N2EzNTZlNSIsImlhdCI6MTc0MzAxMzczNiwiZXhwIjoxNzQzMDE1NTM2LCJpc3MiOiJodHRwczovL2Y0MTk1YTZkdHJpYWwuYXV0aGVudGljYXRpb24udXMxMC5oYW5hLm9uZGVtYW5kLmNvbS9vYXV0aC90b2tlbiIsInppZCI6IjFjZDFjMWU0LWI0ODYtNDhmNC1iNDM2LTIyZjlmMTY4MTdiOCIsImF1ZCI6WyJzZXJ2aWNlLW1hbmFnZXIhYjE0NzYuc3ViYWNjb3VudC5zZXJ2aWNlX3BsYW4iLCJzZXJ2aWNlLW1hbmFnZXIhYjE0NzYuc3ViYWNjb3VudC5icm9rZXIiLCJzZXJ2aWNlLW1hbmFnZXIhYjE0NzYuc3ViYWNjb3VudC5wbGF0Zm9ybSIsInNlcnZpY2UtbWFuYWdlciFiMTQ3Ni5zdWJhY2NvdW50LnNlcnZpY2VfaW5zdGFuY2UiLCJzYi01M2RkOGMwNC00MjY0LTQwMjgtYmNhOS1lMjJlMDNjOWFhMDQhYjM4ODUxMHxzZXJ2aWNlLW1hbmFnZXIhYjE0NzYiLCJ1YWEiLCJzZXJ2aWNlLW1hbmFnZXIhYjE0NzYuc3ViYWNjb3VudC5zZXJ2aWNlX29mZmVyaW5nIiwic2VydmljZS1tYW5hZ2VyIWIxNDc2LnN1YmFjY291bnQuc2VydmljZV9iaW5kaW5nIl19.WE2GNNm6DXkliKnDP93ZM5UxlGvy5c2W1PNnnq12iZikEV9qwAEEyDIqGXlItRYbsOUZox-OaBsNp4egtY3oDYkamsexJL5pNad3Zk0NicqZDO6YpU5wPkiDl71JhYVGz_NwStr1tlIIp-P2DoQABQYA2QGwQS3Mo8DcS3AniuyqxgNLTm2mXXukBa3cNxWDkSYGfBx83haS5KN66-xozGvvk9JW8Wuu6YetbnyPVI4YvrKXWcaRNdjQbtQBhOnQI5WjeBYvJwd8arECzF5yF-qVL7zlAb13q3Dde1SviXqMn57f8nnMmPQIdDUHtBpPsqYD4JU6iznsY3ZvihhNPA

#Instance ID of a SAP HANA Cloud instance in the same subaccount as the service manager instance
@instanceid = 61554ac6-5795-4162-86a9-70bbb2bdfcfe

#Authorization REST API call --------------------

#Request bearer token
#See also https://help.sap.com/docs/service-manager/sap-service-manager/retrieve-oauth2-access-token
#Note that by default the token expires after 1799 seconds or 30 minutes as seen in the response in the expires_in field
GET {{uaa_url}}/{{oauth}}
Authorization: Basic {{clientid}}:{{clientsecret}}

###

#Service plan query
#See also https://help.sap.com/docs/service-manager/sap-service-manager/filtering-parameters-and-operators
#See also https://api.sap.com/api/APIServiceManager/resource/Service_Plans
GET {{uri}}/v1/service_plans?fieldQuery=name eq 'hana'
Authorization: Bearer {{bearer}}

###

#Instance query
#See also https://api.sap.com/api/APIServiceManager/resource/Service_Instances
GET {{uri}}/v1/service_instances
Authorization: Bearer {{bearer}}

###

#Instance query with filter
GET {{uri}}/v1/service_instances?fieldQuery=name eq 'nrdb'
Authorization: Bearer {{bearer}}

###

#Instance query with params
GET {{uri}}/v1/service_instances/{{instanceid}}/parameters
Authorization: Bearer {{bearer}}

###

#Update description of an instance provisioned in a subaccount (Other)
#Service manager can not update instances provisioned in Cloud Foundry spaces
PATCH {{uri}}/v1/service_instances/{{instanceid}}
Authorization: Bearer {{bearer}}

{
    "parameters": {
        "metadata": {
          "ui.hc.sap.com/description": "Created as part of Automation Tutorial!"
        }
    }
}

###

#Update label
PATCH {{uri}}/v1/service_instances/{{instanceid}}
Authorization: Bearer {{bearer}}

{
  "labels": [
    {
      "op": "add",
      "key": "Contact",
      "values": [
        "Dan at 123 456 7890"
      ]
    }
  ]
}

###

#Stop instance
PATCH {{uri}}/v1/service_instances/{{instanceid}}
Authorization: Bearer {{bearer}}

{
    "parameters": {
        "data": {
            "serviceStopped": true
        }
    }
}

###

#Start instance
PATCH {{uri}}/v1/service_instances/{{instanceid}}
Authorization: Bearer {{bearer}}

{
    "parameters": {
        "data": {
            "serviceStopped": false
        }
    }
}

###

#Create
#The service_plan_id and the systempassword will need to be updated
POST {{uri}}/v1/service_instances
Authorization: Bearer {{bearer}}
Content-Type: application/json
#Content-Type: application/x-www-form-urlencoded

{
  "name": "HC_HDB",
  "service_plan_id": "3647b218-dbf1-4cec-af64-cede4d48edbf",
  "parameters": {
    "data": {
      "systempassword": "ManagerPWD1234",
      "edition": "cloud",
      "memory": 30,
      "vcpu": 2,
      "additionalWorkers": 0,
      "whitelistIPs": [
        "0.0.0.0/0"
      ],
      "extensionservices": [
        {
          "name": "ConnectivityProxy",
          "enabled": false,
          "whitelistIPs": [
            "0.0.0.0/0"
          ]
        }
      ],
      "enabledservices": {
        "scriptserver": false,
        "docstore": false,
        "dpserver": true
      },
      "storage": 120,
      "availabilityZonePlacement": {
        "primaryAvailabilityZone": "us-east-1d",
        "highAvailabilityCrossMultiAZEnabled": false
      },
      "productVersion": {
        "releaseCycle": "generally-available-quarterly",
        "track": "2023.16"
      }
    },
    "metadata": {
      "ui.hc.sap.com/description": ""
    }
  }
}

###

#DELETE instance
DELETE {{uri}}/v1/service_instances/{{instanceid}}
Authorization: Bearer {{bearer}}
